apiVersion: v1
kind: Service
metadata:
  name: coordinator
  namespace: agent-swarm
  labels:
    app: coordinator
    component: core
spec:
  type: ClusterIP
  selector:
    app: coordinator
  ports:
    - name: http
      port: 8000
      targetPort: 8000
      protocol: TCP
    - name: metrics
      port: 9090
      targetPort: 9090
      protocol: TCP

---
apiVersion: v1
kind: Service
metadata:
  name: coordinator-headless
  namespace: agent-swarm
  labels:
    app: coordinator
    component: core
spec:
  type: ClusterIP
  clusterIP: None  # Headless service for StatefulSet
  selector:
    app: coordinator
  ports:
    - name: http
      port: 8000
      targetPort: 8000

---
apiVersion: v1
kind: Service
metadata:
  name: nats
  namespace: agent-swarm
  labels:
    app: nats
    component: infrastructure
spec:
  type: ClusterIP
  selector:
    app: nats
  ports:
    - name: client
      port: 4222
      targetPort: 4222
    - name: monitoring
      port: 8222
      targetPort: 8222
    - name: cluster
      port: 6222
      targetPort: 6222

---
apiVersion: v1
kind: Service
metadata:
  name: redis
  namespace: agent-swarm
  labels:
    app: redis
    component: infrastructure
spec:
  type: ClusterIP
  selector:
    app: redis
  ports:
    - name: redis
      port: 6379
      targetPort: 6379

---
apiVersion: v1
kind: Service
metadata:
  name: etcd
  namespace: agent-swarm
  labels:
    app: etcd
    component: infrastructure
spec:
  type: ClusterIP
  selector:
    app: etcd
  ports:
    - name: client
      port: 2379
      targetPort: 2379
    - name: peer
      port: 2380
      targetPort: 2380

---
apiVersion: v1
kind: Service
metadata:
  name: ipfs
  namespace: agent-swarm
  labels:
    app: ipfs
    component: infrastructure
spec:
  type: ClusterIP
  selector:
    app: ipfs
  ports:
    - name: api
      port: 5001
      targetPort: 5001
    - name: gateway
      port: 8080
      targetPort: 8080
    - name: swarm
      port: 4001
      targetPort: 4001

---
apiVersion: v1
kind: Service
metadata:
  name: prometheus
  namespace: agent-swarm
  labels:
    app: prometheus
    component: monitoring
spec:
  type: ClusterIP
  selector:
    app: prometheus
  ports:
    - name: http
      port: 9090
      targetPort: 9090

---
apiVersion: v1
kind: Service
metadata:
  name: grafana
  namespace: agent-swarm
  labels:
    app: grafana
    component: monitoring
spec:
  type: LoadBalancer  # Expose externally
  selector:
    app: grafana
  ports:
    - name: http
      port: 3000
      targetPort: 3000
